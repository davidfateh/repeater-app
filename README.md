# Pensieve

![Happiness can be found in the darkest of times, if one only remembers to turn on the light](https://media.giphy.com/media/1BdrmMkllI1e2gdPaS/giphy.gif)

The Pensieve app creates list of key-value pairs in the Contentful web app by using templates that you select on
the screen. Key-value pairs are two pieces of associated information such as:

The Repeater app utilizes the
Contentful [JSON Field](https://www.contentful.com/developers/docs/concepts/data-model/#:~:text=JSON%20Object) to store
a simple `Item` data stucture:

```ts
{
    id: string; // automatically generated by the app
    key: string;
    value: string[];
    error: string;
    helpText: string;
}
```

*Note that the `id` property is automatically generated and useful for developers to differentiate between different
list items even if the labels are the same or similar*

An example item in the Contentful response:

```json
{
  "fields": {
    "jsonField": [
      {
        "id": "fisgh9s8e-sdfhap832",
        "key": "returns-settings-cta-text",
        "value": "Returns FAQ",
        "error": "",
        "helpText": ""
      },
      {
        "id": "asd7f82eiSUHDU-F0sudh4",
        "key": "returns-settings-cta-text",
        "value": "/returns-center-faq",
        "error": "",
        "helpText": ""
      }
    ]
  }
}
```

## The JSON settings objects

To keep the control of the settings for each 'type' of setting groups a json file is used to control which fields are
shown and how they should be validated against the user input.

Below is an example of the json file for the returns settings.

```json
{
  "settingsType": "returnsSettings",
  "fields": {
    "ctaButtonCopy": "My Boll & Branch Order, A Gift - refunded with a Gift Card, Mattress Foundation, Mattress Topper & Rugs",
    "menuTermsCopy": "",
    "menuTermsCopyCtaLink": "Click me",
    "menuTermsCopyCtaCopy": "",
    "returnDays": 36
  },
  "validation": {
    "ctaButtonCopy": "string",
    "menuTermsCopy": "string",
    "menuTermsCopyCtaLink": "string",
    "menuTermsCopyCtaCopy": "number",
    "returnDays": "number"
  },
  "helpText": {
    "ctaButtonCopy": "Separate each button in order using | ",
    "menuTermsCopy": "The terms to show under the buttons on the main Returns page.",
    "menuTermsCopyCtaLink": "The url for the link in the terms copy to go to i.e /pages/faqs",
    "menuTermsCopyCtaCopy": "The 'text' for the link that is in the terms copy",
    "returnDays": "Select the number of days to allow for the returns window.",
    "excludedProductIds": "Product IDs to exclude from returns (defaults to exclude gift cards). Separate products using | "
  }
}

```

`settingType` is just a field to connect the json object to the class but have a recorded setting which could be used in
the future inside the Contentful field if needed.

`fields` are the main fields which the Contentful app will render for the user and what the user will use to enter in
information for their setting.

`validation` is matched against the field keys and takes in a simple value for type matching for some simple validation.

### The usable validation types are:

- string - anything that can be a mixed of letters, numbers and special characters.
- number - any type of number it can be an integer or a float. This will check for a `.` in the float like `12.00` but a
  mix of numbers and letters will cause an error such as `12px`
- greater than - you can use `> X` replacing 'X' for a number to check that the inputted number is **higher** than the
  validated one.
- less than - you can use `< X` replacing 'X' for a number to check that the inputted number is **lower** than the
  validated one.

## Running This App Locally

> This project was bootstrapped with [Create Contentful App](https://github.com/contentful/create-contentful-app).

Before running the app locally, you will need to do 2 things:

* Ensure your Contentful user is admin or developer for the organization.
* Create an [`AppDefinition`](https://www.contentful.com/developers/docs/extensibility/app-framework/app-definition/)
  in your organization with the following properties:
    * The App URL: http://localhost:3000
    * An entry field location with a type of JSON Object

If you are using the UI to create the `AppDefinition`, it should look like this:

![Repeater App Definition UI](./assets/repeater-appdefinition.png)

Once your app definition is created, running `npm run start` will start a local server on port
3000 (http://localhost:3000).

You must create or modify a content type which has a JSON field in order to see the app inside of the Contentful web
app.

## Learn More

[Read more](https://www.contentful.com/developers/docs/extensibility/app-framework/create-contentful-app/) and check out
the video on how to use the CLI.

Create Contentful App uses [Create React App](https://create-react-app.dev/). You can learn more in
the [Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started) and how to
further customize your app.
